"use strict";var e=require("graphql"),t=require("urql/core"),n=require("wonka");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var i=function(e){return e.name.value},o=function(e){return e.typeCondition.name.value},a=function(e){return void 0!==e.alias?e.alias.value:i(e)},s=function(e){return void 0!==e.selectionSet?e.selectionSet.selections:[]},u=function(e){return void 0!==(e=e.typeCondition)?i(e):null},c=function(t){return t.kind===e.Kind.FIELD},l=function(t){return t.kind===e.Kind.INLINE_FRAGMENT},f=function(t){return e.isWrappingType(t)?f(t.ofType):t||null},d="\nhttps://github.com/FormidableLabs/urql-exchange-graphcache/blob/master/docs/help.md#";function p(e,t,n){if(!e)throw(e=Error((t||"Minfied Error #"+n+"\n")+d+n)).name="Graphcache Error",e}var v=function(e,n){return n?e+"("+t.stringifyVariables(n)+")":e},y=function(e){var t=e.indexOf("(");return-1<t?{fieldKey:e,fieldName:e.slice(0,t),arguments:JSON.parse(e.slice(t+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}},h=function(e,t){return e+"."+t},m=function(e,t){return e+"|"+t},g="undefined"!=typeof Promise?Promise.prototype.then.bind(Promise.resolve()):function(e){return setTimeout(e,0)},k=function(){return Object.create(null)},b=null,S=null,_=null,T=function(){return{optimistic:k(),base:new Map,keys:[]}},N=function(e,t){b=e,S=new Set,_=t},x=function(){var e=b;!e.gcScheduled&&0<e.gcBatch.size&&(e.gcScheduled=!0,g((function(){R(e)}))),e.storage&&!e.persistenceScheduled&&(e.persistenceScheduled=!0,g((function(){e.storage.write(e.persistenceBatch),e.persistenceScheduled=!1,e.persistenceBatch=k()}))),_=S=b=null},K=function(){return p(null!==S,"",2),S},F=function(e,t,n,r){_?(void 0===e.optimistic[_]&&(e.optimistic[_]=new Map,e.keys.unshift(_)),e=e.optimistic[_]):e=e.base;var i=e.get(t);void 0===i&&e.set(t,i=k()),void 0!==r||_?i[n]=r:delete i[n]},q=function(e,t,n){for(var r=0,i=e.keys.length;r<i;r++){var o=e.optimistic[e.keys[r]].get(t);if(void 0!==o&&n in o)return o[n]}return void 0!==(e=e.base.get(t))?e[n]:void 0},w=function(e,t){var n=e.keys.indexOf(t);-1<n&&(delete e.optimistic[t],e.keys.splice(n,1))},E=function(e,t,n,r){var i=void 0!==t[n]?t[n]:0;t=t[n]=i+r|0,void 0!==e&&(0>=t?e.add(n):0>=i&&0<t&&e.delete(n))},A=function(e,t,n,r){if("string"==typeof n)E(e,t,n,r);else if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++){var a=n[i];a&&E(e,t,a,r)}},O=function(e,t,n){if(void 0!==n)for(var r in n)t.has(r)||(e.push(y(r)),t.add(r))},P=function(e,t,n,r){O(e,t,r.base.get(n));for(var i=0,o=r.keys.length;i<o;i++)O(e,t,r.optimistic[r.keys[i]].get(n))},R=function(e){e.gcScheduled=!1,e.gcBatch.forEach((function(t){if(0>=(e.refCount[t]||0)){for(var n in e.refLock){var r=e.refLock[n];if(0<(r[t]||0))return;delete r[t]}if(delete e.refCount[t],e.gcBatch.delete(t),void 0!==(n=e.records.base.get(t))&&(e.records.base.delete(t),e.storage))for(var i in n)n=m("r",h(t,i)),e.persistenceBatch[n]=void 0;if(void 0!==(i=e.links.base.get(t)))for(var o in e.links.base.delete(t),i)e.storage&&(n=m("l",h(t,o)),e.persistenceBatch[n]=void 0),A(e.gcBatch,e.refCount,i[o],-1)}else e.gcBatch.delete(t)}))},I=function(e,t){"__typename"!==t&&(e!==b.queryRootKey?S.add(e):void 0!==t&&S.add(h(e,t)))},L=function(e,t){return I(e,t),q(b.records,e,t)},M=function(e,t){return I(e,t),q(b.links,e,t)},B=function(e,t,n){I(e,t),F(b.records,e,t,n),b.storage&&!_&&(e=m("r",h(e,t)),b.persistenceBatch[e]=n)},C=function(e,t,n){var r=b;if(_)var i=r.refLock[_]||(r.refLock[_]=k()),o=r.links.optimistic[_];else{r.storage&&(i=m("l",h(e,t)),r.persistenceBatch[i]=n),i=r.refCount,o=r.links.base;var a=r.gcBatch}o=void 0!==(o=void 0!==o?o.get(e):void 0)?o[t]:null,I(e,t),F(r.links,e,t,n),A(a,i,o,-1),A(a,i,n,1)},D=function(e,t,n,r){return!(!t||t!==u(e)&&s(e).some((function(e){return!!c(e)&&(e=v(i(e),$(e,r.variables)),!function(e,t){return void 0!==L(e,t)||void 0!==M(e,t)}(n,e))})))},Q=function(e,t,n,r){this.typename=e,this.entityKey=t,this.context=r,this.indexStack=[0],this.selectionStack=[n]};Q.prototype.next=function(){for(;0!==this.indexStack.length;){var e=this.indexStack[this.indexStack.length-1]++,t=this.selectionStack[this.selectionStack.length-1];if(e>=t.length)this.indexStack.pop(),this.selectionStack.pop();else if(ce(e=t[e],this.context.variables))if(c(e)){if("__typename"!==i(e))return e}else void 0!==(e=l(e)?e:this.context.fragments[i(e)])&&(void 0!==this.context.schemaPredicates?this.context.schemaPredicates.isInterfaceOfType(u(e),this.typename):D(e,this.typename,this.entityKey,this.context))&&(this.indexStack.push(0),this.selectionStack.push(s(e)))}};var j=function(e){return void 0===e?null:e},G=function(e,t,n){return N(e.data,0),e=W(e,t,n),x(),e},W=function(e,t,n){var r=ae(t.query),i={dependencies:K()},o=s(r),a=e.getRootKey(r.operation);return a===(e={parentTypeName:a,parentKey:a,parentFieldKey:"",fieldName:"",variables:ee(r,t.variables),fragments:ue(t.query),result:i,store:e,schemaPredicates:e.schemaPredicates}).store.getRootKey("query")?z(e,a,o,n):Y(e,a,o,n),i},U=function(e,t,n){N(e.data,n);var r=ae(t.query);n={dependencies:K()};var o,a=e.getRootKey("mutation"),u=e.getRootKey(r.operation);for(p(u===a,"",10),e={parentTypeName:a,parentKey:a,parentFieldKey:"",fieldName:"",variables:ee(r,t.variables),fragments:ue(t.query),result:n,store:e,schemaPredicates:e.schemaPredicates,optimistic:!0},t=k(),r=new Q(u,u,s(r),e);void 0!==(o=r.next());)if(void 0!==o.selectionSet){var c=i(o),l=e.store.optimisticMutations[c];if(void 0!==l){e.fieldName=c,l=l((u=$(o,e.variables))||k(),e.store,e);var f=j(l);H(e,f,s(o)),t[c]=l,void 0!==(o=e.store.updates[a][c])&&o(t,u||k(),e.store,e)}}return x(),n},V=function(e,t,n,i){t=ue(t);var a=Object.keys(t);if(void 0!==(a=t[a[0]])){var u=o(a);n=r({__typename:u},n);var c=e.keyOfEntity(n);c&&(e={parentTypeName:u,parentKey:c,parentFieldKey:"",fieldName:"",variables:i||{},fragments:t,result:{dependencies:K()},store:e,schemaPredicates:e.schemaPredicates},z(e,c,s(a),n))}},z=function(e,t,n,r){var o=t===e.store.getRootKey("query")?t:r.__typename;if("string"==typeof o)for(B(t,"__typename",o),n=new Q(o,t,n,e);void 0!==(o=n.next());){var u=i(o),c=$(o,e.variables);u=v(u,c);var l=r[a(o)];c=h(t,u),void 0===o.selectionSet?B(t,u,l):(l=j(l),o=J(e,c,s(o),l),C(t,u,o))}},J=function(e,t,n,r){if(Array.isArray(r)){for(var i=Array(r.length),o=0,a=r.length;o<a;o++){var s=r[o],u=h(t,""+o);s=J(e,u,n,s),i[o]=s}return i}return null===r?null:(t=null!==(i=e.store.keyOfEntity(r))?i:t,o=r.__typename,void 0!==e.store.keys[r.__typename]||null!==i||"string"!=typeof o||o.endsWith("Connection")||o.endsWith("Edge"),z(e,t,n,r),t)},Y=function(e,t,n,r){var o,u=t===e.store.getRootKey("mutation")||t===e.store.getRootKey("subscription");for(n=new Q(t,t,n,e);void 0!==(o=n.next());){var c=i(o),l=$(o,e.variables),f=h(t,v(c,l));if(void 0!==o.selectionSet){var d=j(r[a(o)]);H(e,d,s(o))}u&&(e.parentTypeName=t,e.parentKey=t,e.parentFieldKey=f,e.fieldName=c,void 0!==(o=e.store.updates[t][c])&&o(r,l||k(),e.store,e))}},H=function(e,t,n){if(Array.isArray(t)){for(var r=Array(t.length),i=0,o=t.length;i<o;i++)r[i]=H(e,t[i],n);return r}null!==t&&(null!==(r=e.store.keyOfEntity(t))?z(e,r,n,t):Y(e,t.__typename,n,t))},X=function(e,t,n){if("Query"!==t){var r=L(t,"__typename");if("string"!=typeof r)return;B(t,"__typename",void 0)}else r=t;for(n=new Q(r,t,n,e);void 0!==(r=n.next());){var o=i(r),a=v(o,$(r,e.variables));if(void 0===r.selectionSet)B(t,a,void 0);else if(r=s(r),o=M(t,a),C(t,a,void 0),B(t,a,void 0),Array.isArray(o)){a=0;for(var u=o.length;a<u;a++){var c=o[a];null!==c&&X(e,c,r)}}else o&&X(e,o,r)}},Z=function(e,t,n,r,i){var o,a=this;this.gcScheduled=!1,this.gc=function(){R(a.data),a.gcScheduled=!1},this.keyOfField=v,this.resolvers=t||{},this.optimisticMutations=r||{},this.keys=i||{},this.schemaPredicates=e,this.updates={Mutation:n&&n.Mutation||{},Subscription:n&&n.Subscription||{}},e?(n=(t=e.schema).getQueryType(),e=t.getMutationType(),t=t.getSubscriptionType(),this.rootFields={query:n=n?n.name:"Query",mutation:e=e?e.name:"Mutation",subscription:t=t?t.name:"Subscription"},this.rootNames=((o={})[n]="query",o[e]="mutation",o[t]="subscription",o)):(this.rootFields={query:"Query",mutation:"Mutation",subscription:"Subscription"},this.rootNames={Query:"query",Mutation:"mutation",Subscription:"subscription"}),this.data=function(e){return{persistenceScheduled:!1,persistenceBatch:k(),gcScheduled:!1,queryRootKey:e,gcBatch:new Set,refCount:k(),refLock:k(),links:T(),records:T(),storage:null}}(this.getRootKey("query"))};Z.prototype.getRootKey=function(e){return this.rootFields[e]},Z.prototype.keyOfEntity=function(e){var t,n=e.__typename,r=e.id,i=e._id;return n?void 0!==this.rootNames[n]?n:(this.keys[n]?t=this.keys[n](e):null!=r?t=""+r:null!=i&&(t=""+i),t?n+":"+t:null):null},Z.prototype.resolveFieldByKey=function(e,t){if(null===(e=null!==e&&"string"!=typeof e?this.keyOfEntity(e):e))return null;var n=L(e,t);return void 0!==n?n:(t=M(e,t))?t:null},Z.prototype.resolve=function(e,t,n){return this.resolveFieldByKey(e,v(t,n))},Z.prototype.invalidateQuery=function(e,n){!function(e,t){var n=ae(t.query);e={variables:ee(n,t.variables),fragments:ue(t.query),store:e,schemaPredicates:e.schemaPredicates},X(e,e.store.getRootKey("query"),s(n))}(this,t.createRequest(e,n))},Z.prototype.inspectFields=function(e){return null!==(e=null!==e&&"string"!=typeof e?this.keyOfEntity(e):e)?function(e){var t=b.links,n=b.records,r=[],i=new Set;return I(e),P(r,i,e,t),P(r,i,e,n),r}(e):[]},Z.prototype.updateQuery=function(e,n){e=t.createRequest(e.query,e.variables),null!==(n=n(this.readQuery(e)))&&W(this,e,n)},Z.prototype.readQuery=function(e){return fe(this,t.createRequest(e.query,e.variables)).data},Z.prototype.readFragment=function(e,t,n){return ve(this,e,t,n)},Z.prototype.writeFragment=function(e,t,n){V(this,e,t,n)};var $=function(t,n){if(void 0===t.arguments||0===t.arguments.length)return null;for(var r=k(),o=0,a=0,s=t.arguments.length;a<s;a++){var u=t.arguments[a],c=e.valueFromASTUntyped(u.value,n);null!=c&&(r[i(u)]=c,o++)}return 0<o?r:null},ee=function(t,n){if(void 0===t.variableDefinitions)return{};var r=n||{};return t.variableDefinitions.reduce((function(t,n){var o=i(n.variable),a=r[o];if(void 0===a){if(void 0===n.defaultValue)return t;a=e.valueFromASTUntyped(n.defaultValue,r)}return t[o]=a,t}),k())},te=function(t){this.schema=e.buildClientSchema(t)};te.prototype.isFieldNullable=function(t,n){return void 0!==(t=ne(this.schema,t,n))&&e.isNullableType(t.type)},te.prototype.isListNullable=function(t,n){return void 0!==(t=ne(this.schema,t,n))&&(t=e.isNonNullType(t.type)?t.type.ofType:t.type,e.isListType(t)&&e.isNullableType(t.ofType))},te.prototype.isFieldAvailableOnType=function(e,t){return!!ne(this.schema,e,t)},te.prototype.isInterfaceOfType=function(t,n){return!(!n||!t)&&(n===t||(t=this.schema.getType(t),n=this.schema.getType(n),t instanceof e.GraphQLObjectType?t===n:(function(t,n){p(t instanceof e.GraphQLInterfaceType||t instanceof e.GraphQLUnionType,"",5)}(t),re(n),this.schema.isPossibleType(t,n))))};var ne=function(e,t,n){if(re(e=e.getType(t)),void 0!==(n=e.getFields()[n]))return n};function re(t,n){p(t instanceof e.GraphQLObjectType,"",3)}var ie=function(t){return t.kind===e.Kind.FRAGMENT_DEFINITION};function oe(t){return t.kind===e.Kind.OPERATION_DEFINITION}var ae=function(e){return p(!!(e=e.definitions.find(oe)),"",1),e};function se(e,t){return e[i(t)]=t,e}var ue=function(e){return e.definitions.filter(ie).reduce(se,{})},ce=function(t,n){if(void 0===(t=t.directives))return!0;for(var r=0,o=t.length;r<o;r++){var a=t[r],s=i(a),u="include"===s;if((u||"skip"===s)&&(a=a.arguments?a.arguments[0]:null)&&"if"===i(a)&&("boolean"==typeof(a=e.valueFromASTUntyped(a.value,n))||null===a))return u?!!a:!a}return!0},le=function(e,t,n){return N(e.data,0),e=fe(e,t,n),x(),e},fe=function(e,t,n){var r=ae(t.query),i=e.getRootKey(r.operation),o=s(r);return e={parentTypeName:i,parentKey:i,parentFieldKey:"",fieldName:"",variables:ee(r,t.variables),fragments:ue(t.query),partial:!1,store:e,schemaPredicates:e.schemaPredicates},n=n||k(),n=i!==e.store.getRootKey("query")?de(e,i,o,n):ye(e,i,o,n),{dependencies:K(),partial:void 0!==n&&e.partial,data:void 0===n?null:n}},de=function(e,t,n,r){if("string"!=typeof r.__typename)return r;t=new Q(t,t,n,e),(n=k()).__typename=r.__typename;for(var i;void 0!==(i=t.next());){var o=a(i),u=r[o];void 0!==i.selectionSet&&null!==u?(u=j(u),n[o]=pe(e,s(i),u)):n[o]=u}return n},pe=function(e,t,n){if(Array.isArray(n)){for(var r=Array(n.length),i=0,o=n.length;i<o;i++)r[i]=pe(e,t,n[i]);return r}return null===n?null:null!==(r=e.store.keyOfEntity(n))?void 0===(e=ye(e,r,t,k()))?null:e:de(e,n.__typename,t,n)},ve=function(e,t,n,i){t=ue(t);var a=Object.keys(t);if(void 0===(a=t[a[0]]))return null;var u=o(a);return"string"==typeof n||n.__typename||(n.__typename=u),(n="string"!=typeof n?e.keyOfEntity(r({__typename:u},n)):n)&&ye({parentTypeName:u,parentKey:n,parentFieldKey:"",fieldName:"",variables:i||{},fragments:t,partial:!1,store:e,schemaPredicates:e.schemaPredicates},n,s(a),k())||null},ye=function(e,t,n,r){var o=e.store,u=e.schemaPredicates,c=t===o.getRootKey("query"),l=c?t:L(t,"__typename");if("string"==typeof l){r.__typename=l,n=new Q(l,t,n,e);for(var f,d=!1,p=!1;void 0!==(f=n.next());){var y=i(f),m=$(f,e.variables),g=a(f),b=v(y,m),S=L(t,b),_=h(t,b),T=void 0,N=o.resolvers[l];if(void 0!==N&&"function"==typeof N[y]){if(e.parentTypeName=l,e.parentKey=t,e.parentFieldKey=_,e.fieldName=y,void 0!==S&&(r[g]=S),T=N[y](r,m||k(),o,e),void 0!==f.selectionSet&&(T=he(e,l,y,_,s(f),r[g]||k(),T)),void 0!==u&&null===T&&!u.isFieldNullable(l,y))return}else void 0===f.selectionSet?T=S:void 0!==(m=M(t,b))?T=me(e,m,l,y,s(f),r[g]):"object"==typeof S&&null!==S&&(T=S);if(void 0===T&&void 0!==u&&u.isFieldNullable(l,y))p=!0,r[g]=null;else{if(void 0===T)return;d=!0,r[g]=T}}return p&&(e.partial=!0),c&&p&&!d?void 0:r}},he=function(e,t,n,r,o,u,c){if(Array.isArray(c)){var l=e.schemaPredicates;l=void 0===l||l.isListNullable(t,n);for(var f=Array(c.length),d=0,p=c.length;d<p;d++){var y=he(e,t,n,h(r,""+d),o,void 0!==u?u[d]:void 0,c[d]);if(void 0===y&&!l)return;f[d]=void 0!==y?y:null}return f}return null==c?c:ge(c)?(t=void 0===u?k():u,"string"==typeof c?ye(e,c,o,t):function(e,t,n,r,o){var u=e.schemaPredicates;t=e.store.keyOfEntity(o)||t;var c=o.__typename,l=L(t,"__typename")||c;if(!("string"!=typeof l||c&&l!==c)){r.__typename=l,n=new Q(l,t,n,e);for(var f=!1,d=!1;void 0!==(c=n.next());){var p=i(c),y=a(c),m=v(p,$(c,e.variables)),g=h(t,m),k=L(t,m),b=o[p],S=void 0;if(void 0!==b&&void 0===c.selectionSet?S=b:void 0===c.selectionSet?S=k:void 0!==b?S=he(e,l,p,g,s(c),r[y],b):void 0!==(m=M(t,m))?S=me(e,m,l,p,s(c),r[y]):"object"==typeof k&&null!==k&&(S=k),void 0===S&&void 0!==u&&u.isFieldNullable(l,p))d=!0,r[y]=null;else{if(void 0===S)return;f=!0,r[y]=S}}return d&&(e.partial=!0),f?r:void 0}}(e,r,o,t,c)):void 0},me=function(e,t,n,r,i,o){if(Array.isArray(t)){var a=e.schemaPredicates;a=void 0!==a&&a.isListNullable(n,r);for(var s=Array(t.length),u=0,c=t.length;u<c;u++){var l=me(e,t[u],n,r,i,void 0!==o?o[u]:void 0);if(void 0===l&&!a)return;s[u]=void 0!==l?l:null}return s}return null===t?null:ye(e,t,i,void 0===o?k():o)},ge=function(e){return"string"==typeof e||"object"==typeof e&&"string"==typeof e.__typename},ke=function(e,t){return r(r({},e),{context:r(r({},e.context),{meta:r(r({},e.context.meta),{cacheOutcome:t})})})},be=function(e){return r(r({},e),{query:t.formatDocument(e.query)})},Se=function(e){return e.context.requestPolicy},_e=function(e){return"query"===e.operationName},Te=function(e){return _e(e)&&"network-only"!==Se(e)},Ne=function(e,t){return r(r({},e),{context:r(r({},e.context),{requestPolicy:t})})};function xe(e){return Te(e)}function Ke(e){return ke(e.operation,e.outcome)}function Fe(e){return"miss"===e.outcome}function qe(e){return"miss"!==e.outcome}function we(e){return!Te(e)}function Ee(e){return"populate"!==i(e)}function Ae(e,t){return"FragmentDefinition"===t.kind&&e.add(t.name.value),e}var Oe=function(t,n,o,a){function u(t,n){if(!(n=o[n.name]))return t;for(var r=0,s=n.length;r<s;r++){for(var u=n[r].fragment,c=i(u),p=Ie(u),v=0,y=p.length;v<y;v++){var h=p[v];d.has(h)||(l[h]=a[h])}f[c]=u,t.push({kind:e.Kind.FRAGMENT_SPREAD,name:Pe(c)})}return t}var c=new e.TypeInfo(t),l=k(),f=k(),d=new Set;return e.visit(n,e.visitWithTypeInfo(c,{Field:{enter:function(n){if(n.directives){var i=n.directives.filter(Ee);if(i.length!==n.directives.length){var o=Re(t,c).reduce(u,[]),a=s(n);return o=0!==a.length+o.length?o.concat(a):[{kind:e.Kind.FIELD,name:Pe("__typename")}],r(r({},n),{directives:i,selectionSet:{kind:e.Kind.SELECTION_SET,selections:o}})}}}},Document:{enter:function(e){e.definitions.reduce(Ae,d)},leave:function(e){var t,n=[].concat(e.definitions);for(t in f)n.push(f[t]);for(var i in l)n.push(l[i]);return r(r({},e),{definitions:n})}}}))},Pe=function(t){return{kind:e.Kind.NAME,value:t}},Re=function(t,n){return n=f(n.getType()),e.isCompositeType(n)?e.isAbstractType(n)?t.getPossibleTypes(n):[n]:[]},Ie=function(t){var n=[];return e.visit(t,{FragmentSpread:function(e){n.push(i(e))}}),n};exports.Store=Z,exports.cacheExchange=function(e){return function(t){function r(e){var t=e.operation,n=e.outcome,r=Se(t);return e={operation:ke(t,n),data:e.data,error:e.error,extensions:e.extensions},("cache-and-network"===r||"cache-first"===r&&"partial"===n)&&(e.stale=!0,o.reexecuteOperation(Ne(t,"network-only"))),e}var i=t.forward,o=t.client;e||(e={});var a=new Z(e.schema?new te(e.schema):void 0,e.resolvers,e.updates,e.optimistic,e.keys);if(e.storage)var s=e.storage,u=s.read().then((function(e){!function(e,t,n){for(var r in N(e,0),n){var i=r.indexOf("."),o=r.slice(2,i);switch(i=r.slice(i+1),r.charCodeAt(0)){case 108:C(o,i,n[r]);break;case 114:B(o,i,n[r])}}x(),e.storage=t}(a.data,s,e)}));var c=new Set,l=new Map,f=k(),d=function(e,t){void 0!==t&&t.forEach((function(t){var n=f[t];if(void 0!==n){f[t]=[],t=0;for(var r=n.length;t<r;t++)e.add(n[t])}}))},p=function(e,t){t.forEach((function(t){if(t!==e.key){var n=l.get(t);void 0!==n&&(l.delete(t),o.reexecuteOperation(Ne(n,"cache-first")))}}))},v=function(e){if(function(e){return function(e){return"mutation"===e.operationName}(e)&&"network-only"!==Se(e)}(e)){var t=e.key,n=U(a,e,t).dependencies;0!==n.size&&(c.add(t),t=new Set,d(t,n),p(e,t))}},y=function(e,t){t.forEach((function(t){(f[t]||(f[t]=[])).push(e.key),l.has(e.key)||l.set(e.key,"network-only"===Se(e)?Ne(e,"cache-and-network"):e)}))},h=function(e){var t=le(a,e),n=t.data,r=t.dependencies;return t=t.partial,null===n?r="miss":(y(e,r),r=t&&"cache-only"!==Se(e)?"partial":"hit"),{outcome:r,operation:e,data:n}},m=function(e){var t=e.operation,n=e.error,r=e.extensions,i=_e(t),o=e.data,s=t.key;if(c.has(s)&&(c.delete(s),function(e,t){delete e.refLock[t],w(e.records,t),w(e.links,t)}(a.data,s)),null!=o){var u=G(a,t,o).dependencies;if(i){var l=le(a,t);o=l.data,l=l.dependencies}else o=le(a,t,o).data}return s=new Set,d(s,u),i&&d(s,l),p(e.operation,s),i&&void 0!==l&&y(e.operation,l),{data:o,error:n,extensions:r,operation:t}};return function(e){e=n.share(e);var t=u?n.mergeMap(n.fromArray)(n.take(1)(n.buffer(n.fromPromise(u))(e))):n.empty;e=n.share(n.tap(v)(n.map(be)(n.concat([t,e]))));var o=n.share(n.map(h)(n.filter(xe)(e)));return t=n.map(Ke)(n.filter(Fe)(o)),o=n.map(r)(n.filter(qe)(o)),e=n.map(m)(i(n.merge([n.filter(we)(e),t]))),n.merge([e,o])}}},exports.clearDataState=x,exports.initDataState=N,exports.populateExchange=function(t){var o=t.schema;return function(t){function a(e){return l.has(e.key)}var s=t.forward,u=e.buildClientSchema(o),c=new Set,l=new Set,d=k(),v=k(),y=function(e){if("mutation"!==e.operationName)return e;var t,n=k();for(t in v)n[t]=v[t].filter(a);return r(r({},e),{query:Oe(u,e.query,n,d)})},h=function(t){var n=t.key,r=t.query;if("query"===t.operationName&&(l.add(n),!c.has(n))){c.add(n),r=(t=function(t,n){var r=[],i=[],o=new e.TypeInfo(t);return e.visit(n,e.visitWithTypeInfo(o,{Field:function(t){if(t.selectionSet){var n=function(t){return p((t=f(t.getType()))&&!e.isAbstractType(t),"",18),t.toString()}(o);i.push({kind:e.Kind.FRAGMENT_DEFINITION,typeCondition:{kind:e.Kind.NAMED_TYPE,name:Pe(n)},name:Pe(n+"_PopulateFragment_"),selectionSet:t.selectionSet})}},FragmentDefinition:function(e){r.push(e)}})),[r,i]}(u,r))[0],t=t[1];for(var o=0,a=r.length;o<a;o++){var s=r[o];d[i(s)]=s}for(r=0,o=t.length;r<o;r++)s=i((a=t[r]).typeCondition),s=v[s]||(v[s]=[]),a.name.value+=s.length,s.push({key:n,fragment:a})}},m=function(e){"teardown"===e.operationName&&l.delete(e.key)};return function(e){return s(n.map(y)(n.tap(m)(n.tap(h)(e))))}}},exports.query=le,exports.read=fe,exports.write=G,exports.writeFragment=V,exports.writeOptimistic=U;
